# Модуль "FileManager" (Файловий менеджер)

Цей модуль додає в адмін-панель сторінку для перегляду структури файлів та папок Laravel-проекту. Модуль дозволяє переглядати файли, їх вміст, завантажувати файли та навігувати по директоріях проекту.

## Можливості

- Перегляд структури папок та файлів проекту
- Навігація по директоріях
- Детальна інформація про файли (розмір, тип, дата зміни, права доступу)
- Попередній перегляд текстових файлів
- Підсвітка синтаксису для популярних мов (PHP, Blade/HTML, CSS, JS тощо)
- Вбудований редактор текстових файлів (для файлів з правами на запис)
- Завантаження файлів
- Гнучка конфігурація (виключення папок, обмеження розміру файлів тощо)
- Захист від несанкціонованого доступу за межі базової директорії

## Інструкція з встановлення

### 1. Копіюйте модуль у проєкт

Скопіюйте директорію `app/Modules/FileManager` у свій Laravel-проєкт (у той самий шлях `app/Modules/FileManager`).

### 2. Зареєструйте сервіс-провайдер

Відкрийте `config/app.php` та додайте до масиву `providers` клас:

```php
App\Modules\FileManager\FileManagerServiceProvider::class,
```

Переконайтеся, що у вашій адмін-панелі існує middleware `auth.admin` (або замініть його на власний у файлі `app/Modules/FileManager/FileManagerServiceProvider.php`).

### 3. Опублікуйте конфігурацію (опціонально)

Запустіть команду для публікації конфігурації:

```bash
php artisan vendor:publish --tag=file-manager-config
```

Це створить файл `config/file-manager.php`, де можна змінити:
- `route_prefix` - префікс маршруту (за замовчуванням `/admin/file-manager`)
- `base_path` - базову директорію для перегляду
- `excluded_directories` - список директорій для виключення
- `excluded_extensions` - список розширень файлів для виключення
- `max_file_display_size` - максимальний розмір файлу для попереднього перегляду
- `allow_download` - дозвіл на завантаження файлів
- `allow_preview` - дозвіл на попередній перегляд файлів
- `allow_edit` - дозвіл на редагування текстових файлів безпосередньо у браузері

### 4. Опублікуйте шаблони (опціонально)

Щоб перевизначити Blade-шаблони, виконайте:

```bash
php artisan vendor:publish --tag=file-manager-views
```

Після цього шаблони будуть доступні у `resources/views/vendor/file-manager`.

### 5. Оновіть навігацію адмін-панелі

Додайте пункт меню, який веде на маршрут `file-manager.index`:

```blade
<a href="{{ route('file-manager.index') }}">Файловий менеджер</a>
```

У стандартній конфігурації це буде `/admin/file-manager`.

### 6. Перевірте доступність сторінки

Після авторизації в адмінці відкрийте URL з пункту меню (наприклад, `/admin/file-manager`). Ви повинні побачити інтерфейс файлового менеджера з можливістю переглянути структуру проекту.

## Безпека

Модуль включає захист від несанкціонованого доступу:
- Перевірка всіх шляхів для запобігання directory traversal атакам
- Обмеження доступу через middleware `auth.admin`
- Конфігуровані виключення директорій (vendor, node_modules, .git тощо)
- Обмеження розміру файлів для попереднього перегляду

**Важливо:** Переконайтеся, що middleware `auth.admin` правильно налаштований і захищає адмін-панель від неавторизованого доступу.

## Використання

### Навігація

- Натисніть на директорію або кнопку "Відкрити", щоб перейти в неї
- Використовуйте кнопку "Назад" для повернення
- Кнопка "Кореневий каталог" (іконка будинку) повертає до початкової директорії
- Кнопка "Оновити" перезавантажує поточну директорію

### Перегляд файлів

- Клацніть на файлі, щоб переглянути його інформацію в правій панелі
- Натисніть іконку "ока", щоб відкрити попередній перегляд текстового файлу
- Натисніть іконку "завантаження", щоб завантажити файл

### Редагування файлів

- Натисніть іконку "олівця" поруч із файлом або кнопку "Редагувати файл" у правій панелі (доступно лише для текстових файлів, до яких є права на запис)
- Вбудований редактор відкриває файл із підсвіткою синтаксису для PHP, Blade/HTML, CSS, JavaScript, Markdown, SQL, shell-скриптів тощо
- Зміни зберігаються по натисканню кнопки "Зберегти" та одразу ж доступні в файловій системі

### Інформаційна панель

Права панель показує детальну інформацію про вибраний файл або папку:
- Назва
- Тип (файл/директорія)
- Шлях
- Розмір (для файлів)
- Розширення (для файлів)
- MIME тип
- Дата останньої зміни
- Права доступу (читання/запис)

## API Endpoints

Модуль надає наступні endpoints:

- `GET /admin/file-manager` - Головна сторінка файлового менеджера (параметри `path` і `select` дозволяють відкрити конкретну папку й одразу підсвітити файл)
- `GET /admin/file-manager/tree?path={path}` - Отримати список файлів та папок
- `GET /admin/file-manager/info?path={path}` - Отримати інформацію про файл/папку
- `GET /admin/file-manager/preview?path={path}` - Отримати вміст текстового файлу
- `GET /admin/file-manager/download?path={path}` - Завантажити файл
- `POST /admin/file-manager/update` - Зберегти зміни у текстовому файлі (поля `path` та `content`)

Всі endpoints повертають JSON відповіді з полем `success` та відповідними даними або помилками.

## Налаштування

### Виключення директорій

За замовчуванням виключені наступні директорії:
- `node_modules`
- `vendor`
- `storage/framework`
- `storage/logs`
- `.git`
- `.idea`
- `nbproject`

Ви можете змінити цей список у файлі конфігурації `config/file-manager.php`.

### Зміна базової директорії

Щоб обмежити перегляд лише певною папкою, змініть параметр `base_path` у конфігурації:

```php
'base_path' => 'public', // Показувати тільки public директорію
```

### Вимкнення функцій

Ви можете вимкнути завантаження або попередній перегляд файлів:

```php
'allow_download' => false,
'allow_preview' => false,
'allow_edit' => false,
```

## Глибокі посилання

Файловий менеджер підтримує відкриття конкретної директорії або файлу за допомогою query-параметрів:

- `path` — відносний шлях до папки, яку слід відкрити одразу після завантаження сторінки (наприклад, `database/migrations`). Якщо сюди передати шлях до конкретного файлу, менеджер автоматично відкриє батьківську директорію і підсвітить цей файл.
- `select` — відносний шлях до файлу/папки, яку потрібно виділити в списку (наприклад, `database/migrations/2023_01_01_000000_create_users_table.php`). Якщо передати лише `select`, менеджер сам визначить потрібну директорію і відкриє її.

Приклад лінку: `{{ route('file-manager.index', ['path' => 'database/migrations', 'select' => 'database/migrations/2023_01_01_000000_create_users_table.php']) }}`.

Це дозволяє іншим модулям (наприклад, менеджеру міграцій) відкривати файловий менеджер вже в потрібному місці без додаткових кліків.

## Вимоги

- Laravel 10.x або новіша версія
- PHP 8.1 або новіша версія
- Налаштований middleware `auth.admin` для захисту адмін-панелі

## Портованість

Модуль розроблений як самодостатній і легко переноситься в інші Laravel-проекти. Для перенесення достатньо скопіювати директорію модуля та зареєструвати його сервіс-провайдер.

## Ліцензія

Цей модуль розповсюджується під тією ж ліцензією, що й основний проект Laravel (MIT License).
